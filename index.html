<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>蚕桑小管家 AI 网页游戏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f8ff;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        h1 {
            color: #228b22;
        }
        .stars-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            font-size: 2em;
        }
        .main-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin: 50px 0;
        }
        .task-button {
            background-color: #90ee90;
            border: none;
            color: black;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            cursor: pointer;
            border-radius: 8px;
        }
        .task-button:hover {
            background-color: #3cb371;
        }
        .task-container, .drag-drop-container {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
        }
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .back-button {
            background-color: #add8e6;
            border: none;
            color: black;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
        }
        .back-button:hover {
            background-color: #87ceeb;
        }
        .next-button {
            background-color: #90ee90;
            border: none;
            color: white;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
        }
        .next-button:hover {
            background-color: #3cb371;
        }
        .task-content {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        .flowchart {
            flex: 1;
            max-width: 400px;
        }
        .flowchart img {
            width: 100%;
            height: auto;
            border: 1px solid #ccc;
            border-radius: 10px;
        }
        .right-panel {
            flex: 1;
            max-width: 500px;
        }
        .problem-image {
            width: 100%;
            height: 200px;
            border: 1px solid #ccc;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f9f9f9;
        }
        .question {
            font-size: 18px;
            margin-bottom: 20px;
            text-align: left;
        }
        .choices {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        .choice-button {
            background-color: #add8e6;
            border: none;
            color: black;
            padding: 10px;
            cursor: pointer;
            border-radius: 5px;
            text-align: left;
        }
        .choice-button:hover:not(:disabled) {
            background-color: #87ceeb;
        }
        .choice-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .feedback {
            font-size: 16px;
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        .correct {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .incorrect {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .second-question {
            display: none;
        }
        .next-div {
            display: none;
            margin-top: 20px;
        }
        .hidden {
            display: none;
        }
        /* Drag Drop Styles */
        .drag-drop-container .task-content {
            align-items: flex-start;
        }
        .left-panel {
            flex: 1;
            position: relative;
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 10px;
            min-height: 600px;
        }
        .left-panel img {
            width: 100%;
            height: auto;
            display: block;
        }
        .drop-zone {
            position: absolute;
            border: 2px dashed #999;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 10;
            overflow: hidden;
        }
        .drop-zone img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .components-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
            width: 90%;
            margin-left: auto;
            margin-right: auto;
        }
        .components-grid img {
            width: 200px;
            height: auto;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: grab;
        }
        .components-grid img:active {
            cursor: grabbing;
        }
        .complete-section {
            text-align: center;
            margin: 20px 0;
        }
        #drag-feedback {
            margin-top: 10px;
            display: inline-block;
        }
        .drag-section {
            display: none;
        }
    </style>
</head>
<body>
    <!-- 主页面 -->
    <div id="mainPage">
        <div class="stars-container">
            <span id="star1">☆</span>
            <span id="star2">☆</span>
            <span id="star3">☆</span>
        </div>
        <h1>蚕桑小管家 AI 网页游戏</h1>
        <div class="main-buttons">
            <button class="task-button" onclick="startTask(1)">任务1: 蚕龄判断喂食</button>
            <button class="task-button" onclick="startTask(2)">任务2: 桑叶检验</button>
            <button class="task-button" onclick="startTask(3)">任务3: 蚕病判断</button>
        </div>
    </div>
    <!-- 任务容器 (Quiz for 2&3) -->
    <div id="taskContainer" class="task-container">
        <div class="task-header">
            <h2 id="taskTitle"></h2>
            <button class="back-button" onclick="backToMain()">返回主页面</button>
        </div>
        <div class="task-content">
            <!-- 左边：流程图 -->
            <div class="flowchart">
                <img id="flowchartImg" src="" alt="流程图" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjBmOGZmIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5mbG93Y2hhcnQucG5nPC90ZXh0Pjwvc3ZnPg=='">
            </div>
            <!-- 右边：问题面板 -->
            <div class="right-panel">
                <!-- 问题图片 -->
                <div class="problem-image">
                    <img id="problemImg1" src="" alt="问题图片" style="max-width:100%; max-height:100%;" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjlmOWY5Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTQiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5wcm9ibGVtXzEucG5nPC90ZXh0Pjwvc3ZnPg=='">
                </div>
                <div class="question" id="question1"></div>
                <div class="choices" id="choices1">
                    <button class="choice-button" id="choice1-1" onclick="selectChoice(1, 1)"></button>
                    <button class="choice-button" id="choice1-2" onclick="selectChoice(1, 2)"></button>
                </div>
                <div class="feedback" id="feedback1"></div>
                <!-- 第二问题 -->
                <div class="second-question" id="secondQuestion">
                    <div class="question" id="question2"></div>
                    <div class="choices" id="choices2">
                        <button class="choice-button" id="choice2-1" onclick="selectChoice(2, 1)"></button>
                        <button class="choice-button" id="choice2-2" onclick="selectChoice(2, 2)"></button>
                    </div>
                    <div class="feedback" id="feedback2"></div>
                    <div class="next-div" id="nextDiv">
                        <button class="next-button" onclick="nextScenario()">下一张图片</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Drag Drop 容器 (for 1) -->
    <div id="dragDropContainer" class="drag-drop-container">
        <div class="task-header">
            <h2 id="drag-title"></h2>
            <button class="back-button" onclick="backToMain()">返回主页面</button>
        </div>
        <!-- 问题: 拖拽补充流程图 -->
        <div id="dragSection" class="drag-section">
            <div class="task-content">
                <!-- 左边：待补充流程图 -->
                <div class="left-panel">
                    <img id="skeleton" src="" alt="流程图骨架" style="width:100%; height:auto; position:relative; z-index:1;">
                    <!-- 预留位置：根据骨架图片调整 top/left -->
                    <!-- 输入位置 -->
                    <div id="input-zone" class="drop-zone" style="position:absolute; z-index:2;"></div>
                    <!-- 判断位置 -->
                    <div id="judgment-zone" class="drop-zone" style="position:absolute; z-index:2;"></div>
                    <!-- 是分支位置 -->
                    <div id="yes-zone" class="drop-zone" style="position:absolute; z-index:2;"></div>
                    <!-- 否分支位置 -->
                    <div id="no-zone" class="drop-zone" style="position:absolute; z-index:2;"></div>
                </div>
                <!-- 右边：组件 -->
                <div class="right-panel">
                    <h3>流程图组件</h3>
                    <div id="components-list" class="components-grid"></div>
                </div>
            </div>
            <div class="complete-section">
                <button class="next-button" onclick="checkCompletion()">完成问题</button>
                <div id="drag-feedback" class="feedback"></div>
            </div>
        </div>
    </div>
    <script>
        let currentTask = 0;
        let availableScenarios = [];
        let currentScenario = null;
        let currentCorrect = {};
        let completedTasks = [false, false, false]; // 跟踪任务完成状态
        // 任务配置
        const taskConfigs = {
            1: { // 蚕龄判断
                title: "任务1: 蚕龄判断喂食",
                skeleton: "photo/3.png",
                components: [
                    "photo/4-1.png",
                    // "photo/4-5.png",
                    "photo/4-2.png",
                    // "photo/4-6.png",
                    "photo/4-4.png",
                    "photo/4-3.png",
                ],
                correctMapping: {
                    input: "photo/4-1.png",
                    judgment: "photo/4-2.png",
                    yes: "photo/4-3.png",
                    no: "photo/4-4.png"
                }
            },
            2: { // 桑叶检验
                title: "任务2: 桑叶检验",
                flowchart: "photo/1.png",
                scenarios: [
                    {
                        image: "photo/1-2.png",
                        q1: "桑叶表层是否有白粉？",
                        c1_1: "有白粉",
                        c1_2: "没有白粉",
                        correct1: 1,
                        q2: "接下来如何处理？",
                        c2_1: "可喂食",
                        c2_2: "不可喂食",
                        correct2: 2
                    },
                    {
                        image: "photo/1-1.jpg",
                        q1: "桑叶表层是否有白粉？",
                        c1_1: "有白粉",
                        c1_2: "没有白粉",
                        correct1: 2,
                        q2: "接下来如何处理？",
                        c2_1: "可喂食",
                        c2_2: "不可喂食",
                        correct2: 1
                    }
                ]
            },
            3: { // 蚕病判断
                title: "任务3: 蚕病判断",
                flowchart: "photo/2.png",
                scenarios: [
                    {
                        image: "photo/2-2.png",
                        q1: "蚕体是否体色正常？",
                        c1_1: "正常",
                        c1_2: "不正常",
                        correct1: 2,
                        q2: "接下来如何处理？",
                        c2_1: "隔离观察",
                        c2_2: "正常喂养",
                        correct2: 1
                    },
                    {
                        image: "photo/2-1.png",
                        q1: "蚕体是否体色正常？",
                        c1_1: "正常",
                        c1_2: "不正常",
                        correct1: 1,
                        q2: "接下来如何处理？",
                        c2_1: "隔离观察",
                        c2_2: "正常喂养",
                        correct2: 2
                    }
                ]
            }
        };
        function updateStars() {
            const starIds = ['star1', 'star2', 'star3'];
            starIds.forEach((id, index) => {
                const star = document.getElementById(id);
                if (completedTasks[index]) {
                    star.innerHTML = '★';
                    star.style.color = 'gold';
                } else {
                    star.innerHTML = '☆';
                    star.style.color = '#ccc';
                }
            });
        }
        function startTask(taskId) {
            currentTask = taskId;
            const config = taskConfigs[taskId];
            document.getElementById('mainPage').style.display = 'none';
            if (taskId >= 2) {
                // Quiz 模式
                document.getElementById('taskContainer').style.display = 'block';
                document.getElementById('dragDropContainer').style.display = 'none';
                document.getElementById('taskTitle').textContent = config.title;
                document.getElementById('flowchartImg').src = config.flowchart;
                availableScenarios = [...config.scenarios].sort(() => Math.random() - 0.5);
                nextScenario();
            } else {
                // Drag 模式
                document.getElementById('taskContainer').style.display = 'none';
                document.getElementById('dragDropContainer').style.display = 'block';
                setupDrag(config);
            }
        }
        function nextScenario() {
            if (availableScenarios.length === 0) {
                completedTasks[currentTask - 1] = true;
                updateStars();
                alert('所有图片处理完成！任务完成！');
                backToMain();
                return;
            }
            currentScenario = availableScenarios.shift();
            document.getElementById('problemImg1').src = currentScenario.image;
            document.getElementById('question1').textContent = currentScenario.q1;
            document.getElementById('choice1-1').textContent = currentScenario.c1_1;
            document.getElementById('choice1-2').textContent = currentScenario.c1_2;
            document.getElementById('question2').textContent = currentScenario.q2;
            document.getElementById('choice2-1').textContent = currentScenario.c2_1;
            document.getElementById('choice2-2').textContent = currentScenario.c2_2;
            currentCorrect = {first: currentScenario.correct1, second: currentScenario.correct2};
            resetToFirst();
        }
        function backToMain() {
            document.getElementById('taskContainer').style.display = 'none';
            document.getElementById('dragDropContainer').style.display = 'none';
            document.getElementById('mainPage').style.display = 'block';
            if (currentTask >= 2) {
                resetAll();
            } else {
                resetDragDrop();
            }
            window.removeEventListener('resize', adjustZones);
        }
        function resetAll() {
            availableScenarios = [];
            currentScenario = null;
            resetToFirst();
        }
        function resetToFirst() {
            document.getElementById('secondQuestion').style.display = 'none';
            document.getElementById('nextDiv').style.display = 'none';
            document.getElementById('feedback1').style.display = 'none';
            document.getElementById('feedback2').style.display = 'none';
            document.querySelectorAll('#choices1 .choice-button').forEach(btn => {
                btn.disabled = false;
                btn.style.backgroundColor = '#add8e6';
                btn.className = 'choice-button';
            });
            document.querySelectorAll('#choices2 .choice-button').forEach(btn => {
                btn.disabled = false;
                btn.style.backgroundColor = '#add8e6';
                btn.className = 'choice-button';
            });
            document.getElementById('feedback1').textContent = '';
            document.getElementById('feedback1').className = 'feedback';
            document.getElementById('feedback2').textContent = '';
            document.getElementById('feedback2').className = 'feedback';
        }
        function selectChoice(questionNum, choiceNum) {
            const feedbackId = `feedback${questionNum}`;
            const choicesId = `choices${questionNum}`;
            const feedbackEl = document.getElementById(feedbackId);
            const choiceBtns = document.querySelectorAll(`#${choicesId} .choice-button`);
            choiceBtns.forEach(btn => btn.disabled = true);
            const key = (questionNum === 1 ? 'first' : 'second');
            const isCorrect = choiceNum === currentCorrect[key];
            const word = (questionNum === 1 ? '判断' : '执行');
            const message = isCorrect ? `${word}正确！` : `${word}错误！请重试。`;
            feedbackEl.textContent = message;
            feedbackEl.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedbackEl.style.display = 'block';
            if (questionNum === 1 && isCorrect) {
                document.getElementById('secondQuestion').style.display = 'block';
            } else if (questionNum === 1 && !isCorrect) {
                setTimeout(() => {
                    document.getElementById('feedback1').style.display = 'none';
                    document.querySelectorAll('#choices1 .choice-button').forEach(btn => {
                        btn.disabled = false;
                        btn.style.backgroundColor = '#add8e6';
                        btn.className = 'choice-button';
                    });
                }, 2000);
            } else if (questionNum === 2) {
                if (isCorrect) {
                    document.getElementById('nextDiv').style.display = 'block';
                } else {
                    setTimeout(() => {
                        document.getElementById('feedback2').style.display = 'none';
                        document.querySelectorAll('#choices2 .choice-button').forEach(btn => {
                            btn.disabled = false;
                            btn.style.backgroundColor = '#add8e6';
                            btn.className = 'choice-button';
                        });
                    }, 2000);
                }
            }
        }
        // Drag 专用设置
        function setupDrag(config) {
            document.getElementById('drag-title').textContent = config.title;
            document.getElementById('dragSection').style.display = 'block';
            document.getElementById('skeleton').src = config.skeleton;
            const list = document.getElementById('components-list');
            list.innerHTML = '';
            config.components.forEach((src, index) => {
                const img = document.createElement('img');
                img.src = src;
                img.dataset.originalSrc = src;
                img.draggable = true;
                img.id = `comp_${index}`;
                img.ondragstart = drag;
                img.onerror = () => { img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2NjYyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjEyIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+5Y2a5a6aPC90ZXh0Pjwvc3ZnPg=='; };
                list.appendChild(img);
            });
            currentCorrect = config.correctMapping;
            const zones = ['input-zone', 'judgment-zone', 'yes-zone', 'no-zone'];
            zones.forEach(id => {
                const zone = document.getElementById(id);
                zone.ondragover = allowDrop;
                zone.ondrop = drop;
            });
            resetDragDrop();
            window.addEventListener('resize', adjustZones);
            adjustZones();
        }
        // Drag Drop 函数
        function drag(ev) {
            ev.dataTransfer.setData("text/plain", ev.target.id);
        }
        function allowDrop(ev) {
            ev.preventDefault();
        }
        function drop(ev) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text/plain");
            const dragged = document.getElementById(data);
            const zone = ev.currentTarget;
            if (zone.classList.contains('drop-zone') && zone.children.length === 0) {
                dragged.style.width = '100%';
                dragged.style.height = '100%';
                dragged.style.objectFit = 'contain';
                zone.appendChild(dragged);
                // 添加双击撤回事件
                dragged.ondblclick = function(e) {
                    e.stopPropagation();
                    removeFromZone(dragged);
                };
            }
        }
        function removeFromZone(img) {
            const zone = img.parentElement;
            zone.removeChild(img);
            img.style.width = '';
            img.style.height = '';
            img.style.objectFit = '';
            img.removeAttribute('ondblclick');
            const list = document.getElementById('components-list');
            list.appendChild(img);
        }
        function checkCompletion() {
            const zones = {
                input: document.getElementById('input-zone').querySelector('img')?.dataset.originalSrc || '',
                judgment: document.getElementById('judgment-zone').querySelector('img')?.dataset.originalSrc || '',
                yes: document.getElementById('yes-zone').querySelector('img')?.dataset.originalSrc || '',
                no: document.getElementById('no-zone').querySelector('img')?.dataset.originalSrc || ''
            };
            let isCorrect = true;
            Object.keys(currentCorrect).forEach(key => {
                if (zones[key] !== currentCorrect[key]) {
                    isCorrect = false;
                }
            });
            const feedbackEl = document.getElementById('drag-feedback');
            if (isCorrect) {
                completedTasks[currentTask - 1] = true;
                updateStars();
                feedbackEl.textContent = '正确！问题完成。任务完成！';
                feedbackEl.className = 'feedback correct';
                feedbackEl.style.display = 'block';
                setTimeout(backToMain, 2000);
            } else {
                feedbackEl.textContent = '错误！请重新尝试。';
                feedbackEl.className = 'feedback incorrect';
                feedbackEl.style.display = 'block';
                setTimeout(resetDragDrop, 2000);
            }
        }
        function resetDragDrop() {
            const zoneIds = ['input-zone', 'judgment-zone', 'yes-zone', 'no-zone'];
            const list = document.getElementById('components-list');
            zoneIds.forEach(zoneId => {
                const zone = document.getElementById(zoneId);
                while (zone.firstChild) {
                    const img = zone.firstChild;
                    img.style.width = '';
                    img.style.height = 'auto';
                    img.style.objectFit = '';
                    img.removeAttribute('ondblclick');
                    list.appendChild(img);
                }
            });
            const feedbackEl = document.getElementById('drag-feedback');
            feedbackEl.textContent = '';
            feedbackEl.className = 'feedback';
            feedbackEl.style.display = 'none';
        }
        // 动态调整drop zones
        function adjustZones() {
            const img = document.getElementById('skeleton');
            if (!img.complete) {
                img.onload = adjustZones;
                return;
            }
            const rect = img.getBoundingClientRect();
            // 假设原始高度600px, 宽度400px
            const origHeight = 600;
            const origWidth = 400;
            // 输入
            const inputZone = document.getElementById('input-zone');
            inputZone.style.top = (110 / origHeight * rect.height) + 'px';
            inputZone.style.left = (0.43 * rect.width) + 'px';
            inputZone.style.width = (90 / origWidth * rect.width) + 'px';
            inputZone.style.height = (60 / origHeight * rect.height) + 'px';
            // 判断
            const judgmentZone = document.getElementById('judgment-zone');
            judgmentZone.style.top = (240 / origHeight * rect.height) + 'px';
            judgmentZone.style.left = (0.35 * rect.width) + 'px';
            judgmentZone.style.width = (150 / origWidth * rect.width) + 'px';
            judgmentZone.style.height = (60 / origHeight * rect.height) + 'px';
            // 是
            const yesZone = document.getElementById('yes-zone');
            yesZone.style.top = (375 / origHeight * rect.height) + 'px';
            yesZone.style.left = (0.06 * rect.width) + 'px';
            yesZone.style.width = (100 / origWidth * rect.width) + 'px';
            yesZone.style.height = (50 / origHeight * rect.height) + 'px';
            // 否
            const noZone = document.getElementById('no-zone');
            noZone.style.top = (375 / origHeight * rect.height) + 'px';
            noZone.style.left = (0.73 * rect.width) + 'px';
            noZone.style.width = (100 / origWidth * rect.width) + 'px';
            noZone.style.height = (50 / origHeight * rect.height) + 'px';
        }
        // 初始化星星状态
        updateStars();
    </script>
</body>

</html>


